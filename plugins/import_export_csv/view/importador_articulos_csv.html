{include="header"}

<script type="text/javascript">
   function check_protocolo_csv()
   {
      if(document.f_nueva_url.csv_protocolo.value == 'file')
      {
         $(".ftp").hide();
         $("#csv_url").hide();
         $(".csv_file").show();
      }
      else
      {
         $(".ftp").show();
         $("#csv_url").show();
         $(".csv_file").hide();
      }
   }
   $(document).ready(function() {
      check_protocolo_csv();
      $("#b_nueva_url").click(function(event) {
         event.preventDefault();
         $("#modal_nueva_url").modal('show');
         $(".ftp").hide();
         $("#csv_url").hide();
         $(".csv_file").show();
      });
   });
</script>

<div class="container-fluid">
   <div class="row">
      <div class="col-sm-12">
         <div class="btn-group">
            <a class="btn btn-sm btn-default" href="index.php?page=compras_articulos">
               <span class="glyphicon glyphicon-arrow-left"></span>
               <span class="hidden-xs">&nbsp; Artículos</span>
            </a>
            <a class="btn btn-sm btn-default" href="{$fsc->url()}" title="Recargar la página">
               <span class="glyphicon glyphicon-refresh"></span>
            </a>
         </div>
         <div class="btn-group">
            <a href="#" id="b_nueva_url" class="btn btn-sm btn-success">
               <span class="glyphicon glyphicon-plus"></span>
               <span class="hidden-xs">&nbsp;Añadir</span>
            </a>
            {loop="$fsc->extensions"}
               {if="$value->type=='button'"}
               <a href="index.php?page={$value->from}{$value->params}" class="btn btn-sm btn-default">{$value->text}</a>
               {/if}
            {/loop}
         </div>
         <div class="page-header">
            <h1>
               <span class="glyphicon glyphicon-import"></span>
               Importador avanzado de artículos
            </h1>
            <p class="help-block">
               Desde aquí puedes añadir fuentes de importación de artículos,
               ya sean archivos o urls.
            </p>
         </div>
         <div class="table-responsive">
            <table class="table table-hover">
               <thead>
                  <tr>
                     <th class="text-left">Proveedor</th>
                     <th class="text-left">URL</th>
                     <th class="text-left">Estado</th>
                     <th class="text-right">Última comprobación</th>
                     <th></th>
                  </tr>
               </thead>
               {loop="$fsc->listado"}
               <tr class="clickableRow" href="{$value->url()}">
                  <td>{$value->codproveedor} {$fsc->get_nombre_proveedor($value->codproveedor)}</td>
                  <td>
                     <a href="{$value->url()}">{$value->protocolo}://{$value->url}</a>
                  </td>
                  <td>{$value->estado}</td>
                  <td class="text-right">{$value->timesince()}</td>
                  <td>
                     {if="$value->cron"}
                     <span class="glyphicon glyphicon-time" title="Será procesada por el cron"></span>
                     {/if}
                  </td>
               </tr>
               {else}
               <tr class="warning">
                  <td colspan="5">
                     Ninguna fuente encontrda. Pulsa el botón <b>Añadir</b>
                     para añadir un archivo o url.
                  </td>
               </tr>
               {/loop}
            </table>
         </div>
      </div>
   </div>
</div>

<form name="f_nueva_url" action="{$fsc->url()}" method="post" enctype="multipart/form-data" class="form">
   <div class="modal fade" id="modal_nueva_url" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog">
         <div class="modal-content">
            <div class="modal-header">
               <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
               </button>
               <h4 class="modal-title">Añadir fuente</h4>
            </div>
            <div class="modal-body">
               <div class="form-group">
                  <select name="csv_protocolo" class="form-control" onchange="check_protocolo_csv()">
                     <option value="http">http://</option>
                     <option value="https">https://</option>
                     <option value="ftp">ftp://</option>
                     <option value="file" selected="">file://</option>
                  </select>
                  <input type="text" name="csv_url" id="csv_url" class="form-control" autocomplete="off"/>
                  <p class="help-block">
                     Selecciona <b>file://</b> si lo que quieres es usar un archivo.
                  </p>
               </div>
               <div class="form-group ftp">
                  Usuario:
                  <input type="text" name="csv_user" class="form-control" placeholder="opcional" autocomplete="off"/>
               </div>
               <div class="form-group ftp">
                  Contraseña:
                  <input type="password" name="csv_pass" class="form-control" placeholder="opcional"/>
               </div>
               <div class="form-group csv_file">
                  <input name="csv_file" type="file" accept=".csv"/>
                  <p class="help-block">
                     Este servidor admite un tamaño <b>máximo de {$fsc->get_max_file_upload()} MB</b>.
                     Si el plugin ocupa más, dará error al subirlo, incluso puede que no salga
                     nada.
                  </p>
               </div>
            </div>
            <div class="modal-footer">
               <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled=true;this.form.submit();">
                  <span class="glyphicon glyphicon-floppy-disk"></span>&nbsp; Guardar
               </button>
            </div>
         </div>
      </div>
   </div>
</form>

{include="footer"}