{include="header"}

<div class="container-fluid">
   <div class="row">
      <div class="col-sm-12">
         <div class="page-header">
            <h1>
               <span class="glyphicon glyphicon-transfer"></span>
               Importar/exportar CSV
               <a class="btn btn-xs btn-default" href="{$fsc->url()}" title="Recargar la página">
                  <span class="glyphicon glyphicon-refresh"></span>
               </a>
               <span class="btn-group">
                  {loop="$fsc->extensions"}
                     {if="$value->type=='button'"}
                     <a href="index.php?page={$value->from}{$value->params}" class="btn btn-xs btn-default">{$value->text}</a>
                     {/if}
                  {/loop}
               </span>
            </h1>
            <p class="help-block">
               Desde aquí puedes importar o exportar información en formato CSV.
               <b>Nota</b>: si lo que tienes son archivos de <b>Excel</b>, entonces debes
               guardarlos como CSV antes de importarlos.
            </p>
         </div>
      </div>
   </div>
   <div class="row">
      <div class="col-lg-4 col-sm-12">
         <form enctype="multipart/form-data" action="{$fsc->url()}" method="post">
            <div class="panel panel-warning">
               <div class="panel-heading">
                  <h3 class="panel-title">
                     <span class="glyphicon glyphicon-import"></span>&nbsp; Importar
                  </h3>
               </div>
               <div class="panel-body">
                  <div class="form-group">
                     <input name="fcsv" type="file" accept=".csv"/>
                     <p class='help-block'>
                        ¿No sabes qué columnas debe tener el archivo? Utiliza el
                        panel de exportar para obtener un fichero de ejemplo de
                        cada tipo.
                     </p>
                  </div>
                  <div class="form-group">
                     El archivo contiene:
                     <select name="contiene" class="form-control">
                        <option{if="$fsc->contiene=='articulos'"} selected=""{/if}>articulos</option>
                        <option{if="$fsc->contiene=='clientes'"} selected=""{/if}>clientes</option>
                        <option{if="$fsc->contiene=='contactos'"} selected=""{/if}>contactos</option>
                        <option{if="$fsc->contiene=='fabricantes'"} selected=""{/if}>fabricantes</option>
                        <option{if="$fsc->contiene=='familias'"} selected=""{/if}>familias</option>
                        <option{if="$fsc->contiene=='proveedores'"} selected=""{/if}>proveedores</option>
                     </select>
                  </div>
                  <div class="form-group">
                     Separador de columnas:
                     <input type="text" name="separador" value="{$fsc->separador}" class="form-control" maxlength="1" autocomplete="off"/>
                  </div>
                  <div class="checkbox">
                     <label>
                        <input type="checkbox" name="sobreescribir" value="TRUE"/>
                        Sobreescribir los datos
                     </label>
                  </div>
                  <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled=true;this.form.submit();">
                     <span class="glyphicon glyphicon-import"></span>&nbsp; Procesar
                  </button>
               </div>
               {if="count($fsc->almacen->all())>1"}
               <div class="panel-footer">
                  Almacén:
                  <select class="form-control" name="codalmacen">
                     {loop="$fsc->almacen->all()"}
                        {if="$value->codalmacen==$fsc->codalmacen"}
                        <option value="{$value->codalmacen}" selected="">{$value->nombre}</option>
                        {else}
                        <option value="{$value->codalmacen}">{$value->nombre}</option>
                        {/if}
                     {/loop}
                  </select>
                  <p class="help-block">Si el archivo contiene artículos, puedes seleccionar en qué almacén modificar el stock.</p>
               </div>
               {else}
               <input type="hidden" name="codalmacen" value="{$fsc->empresa->codalmacen}"/>
               {/if}
            </div>
         </form>
      </div>
      <div class="col-lg-4 col-sm-6">
         <div class="panel panel-info">
            <div class="panel-heading">
               <h3 class="panel-title">
                  <span class="glyphicon glyphicon-import"></span>&nbsp; Importación avanzada de artículos
               </h3>
            </div>
            <div class="panel-body">
               <p class="help-block">
                  Si lo que necesitas es una importación avanzada de <b>artículos</b>, es decir,
                  poder definir rutas de archivos, columnas y multitud de variables más...
                  Usa el importador avanzado de artículos.
               </p>
               <a href="index.php?page=importador_articulos_csv" class="btn btn-sm btn-default">
                  <span class="glyphicon glyphicon-import"></span>&nbsp; Importador avanzado
               </a>
            </div>
         </div>
         <div class="panel panel-info">
            <div class="panel-heading">
               <h3 class="panel-title">
                  <span class="glyphicon glyphicon-import"></span>&nbsp; Importación de facturas
               </h3>
            </div>
            <div class="panel-body">
               <p class="help-block">
                  Si necesitas importar facturas de compra o de venta, aquí tienes un asistente
                  que te puede ayudar.
               </p>
               <a href="index.php?page=importador_facturas" class="btn btn-sm btn-default">
                  <span class="glyphicon glyphicon-import"></span>&nbsp; Importador de facturas
               </a>
            </div>
         </div>
         <div class="panel panel-info">
            <div class="panel-heading">
               <h3 class="panel-title">
                  <span class="glyphicon glyphicon-import"></span>&nbsp; Importación de asientos
               </h3>
            </div>
            <div class="panel-body">
               <p class="help-block">
                  Si necesitas importar asientos contables, aquí tienes un asistente
                  que te puede ayudar.
               </p>
               <a href="index.php?page=importador_asientos" class="btn btn-sm btn-default">
                  <span class="glyphicon glyphicon-import"></span>&nbsp; Importador de asientos
               </a>
            </div>
         </div>
         <div class="panel panel-info">
            <div class="panel-heading">
               <h3 class="panel-title">
                  <span class="glyphicon glyphicon-shopping-cart"></span>&nbsp; Generar pedidos de compra
               </h3>
            </div>
            <div class="panel-body">
               <p class="help-block">
                  {if="in_array('presupuestos_y_pedidos',$GLOBALS['plugins'])"}
                  ¿Quieres generar pedidos de compra a partir de los de venta?
                  Ve a <a href="index.php?page=ventas_pedidos">Ventas &gt; Pedidos</a>.
                  {else}
                  ¿Quieres generar pedidos de compra a partir de los de venta?
                  Primero debes instalar el plugin <b>presupuestos_y_pedidos</b>.
                  {/if}
               </p>
            </div>
         </div>
      </div>
      <div class="col-lg-4 col-sm-6">
         <div class="panel panel-success">
            <div class="panel-heading">
               <h3 class="panel-title">
                  <span class="glyphicon glyphicon-export"></span>&nbsp; Exportar
               </h3>
            </div>
            <div class="panel-body">
               <p class="help-block">
                  ¿Quieres exportar los datos de Gtakounting? Selecciona lo que quieras exportar.
               </p>
               <a href="#" class="btn btn-block btn-default" data-toggle="modal" data-target="#modal_articulos">
                  <i class="fa fa-cubes" aria-hidden="true"></i>&nbsp; Artículos...
               </a>
               <a href="{$fsc->url()}&export=clientes" class="btn btn-block btn-default">
                  <i class="fa fa-users" aria-hidden="true"></i>&nbsp; Clientes
               </a>
               <a href="{$fsc->url()}&export=contactos" class="btn btn-block btn-default">
                  <i class="fa fa-users" aria-hidden="true"></i>&nbsp; Contactos
               </a>
               <a href="{$fsc->url()}&export=fabricantes" class="btn btn-block btn-default">
                  <span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span>&nbsp; Fabricantes
               </a>
               <a href="{$fsc->url()}&export=familias" class="btn btn-block btn-default">
                  <span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span>&nbsp; Familias
               </a>
               <a href="{$fsc->url()}&export=proveedores" class="btn btn-block btn-default">
                  <i class="fa fa-users" aria-hidden="true"></i>&nbsp; Proveedores
               </a>
            </div>
         </div>
      </div>
   </div>
</div>

{$fsc->iframe_xid()}

<div class="modal fade" id="modal_articulos" tabindex="-1" role="dialog" aria-hidden="true">
   <div class="modal-dialog modal-lg">
      <div class="modal-content">
         <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
               <span aria-hidden="true">&times;</span>
            </button>
            <h4 class="modal-title">
               <span class="glyphicon glyphicon-search" aria-hidden="true"></span> Selecciona la familia
            </h4>
            <p class="help-block">
               Se exportarán todos los artículos de esa familia. También puedes
               usar el botón <b>descargar</b> del listado de artículos, en Ventas
               &gt; Artículos.
            </p>
         </div>
         <div class="modal-body">
            <div class="container-fluid">
               <div class="row">
                  <div class="col-sm-6">
                     <a href="{$fsc->url()}&export_fam=" class="btn btn-block btn-info">
                        <span class="glyphicon glyphicon-file" aria-hidden="true"></span> Todos
                     </a>
                     <br/>
                  </div>
                  <div class="col-sm-6">
                     <a href="{$fsc->url()}&export_fam=&sin=TRUE" class="btn btn-block btn-info">
                        <span class="glyphicon glyphicon-file" aria-hidden="true"></span> Sin familia
                     </a>
                     <br/>
                  </div>
               </div>
               <div class="row">
                  {loop="$fsc->familia->all()"}
                  <div class="col-sm-6">
                     <a class="btn btn-block btn-default" href="{$fsc->url()}&export_fam={$value->codfamilia}">
                        <span class="glyphicon glyphicon-file" aria-hidden="true"></span> {$value->descripcion}
                     </a>
                  </div>
                  {/loop}
               </div>
            </div>
         </div>
      </div>
   </div>
</div>

{include="footer"}